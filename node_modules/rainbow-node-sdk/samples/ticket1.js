var NodeSDK = require("../index.js");

var nodeSDK = new NodeSDK({
    rainbow: {
        "host": "sandbox.openrainbow.com",
        "mode": "xmpp"
    },
    credentials: {
        "login": "",
        "password": ""
    },
    application: {
        "appID": "",
        "appSecret": ""
    },
    logs: {
        enableConsoleLogs: true,
        enableFileLogs: false,
        file: {
            path: "/var/tmp/rainbowsdk/",
            level: "debug"
        }
    },
    im: {
        sendReadReceipt: true  //false to not send a read receipt automatically
    }
});

nodeSDK.events.on("rainbow_onmessagereceived", (message) => {
    console.log("[Rainbow] >>> MESSAGE RECEIVED", message);

    if(message.type == "chat") {
        nodeSDK.contacts.getContactByJid(message.fromJid).then( (contact) => {
            nodeSDK.im.sendMessageToContact("My answer", {});
        }).catch( (err) => {
            console.log("ERR", err);
        });
    }
    else {
        let bubble = nodeSDK.bubbles.getBubbleByJid(message.fromBubbleJid);
        console.log("BUBBLE", bubble);
        nodeSDK.im.sendMessageToBubble("My answer", bubble);
    }
    
});

nodeSDK.events.on("rainbow_onready", () => {
    console.log("[Rainbow] >>> READY", nodeSDK.state);
});

nodeSDK.start();
